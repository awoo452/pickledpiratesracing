<section class="product-show">

  <div class="product-show-card">

    <h1><%= @product.name %></h1>

    <% if @product.image.present? %>
      <%= image_tag @product.image, alt: @product.name, class: "product-show-image" %>
    <% end %>

    <p class="product-description"><%= @product.description %></p>

    <p class="product-price">
      $<%= number_with_precision(@product.price, precision: 2) %>
    </p>

    <div class="paypal-container" data-turbo="false">
      <div id="paypal-button-container"></div>
    </div>

    <%= link_to "Back to products", products_path, class: "back-link", data: { turbo: false } %>

  </div>

</section>

<script>
  let paypalRendered = false;

  function renderPaypalButton() {
    if (paypalRendered) return;

    if (!window.paypal) {
      setTimeout(renderPaypalButton, 300);
      return;
    }

    paypalRendered = true;

    paypal.Buttons({
      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: { value: "<%= @product.price %>" }
          }]
        });
      },

      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          alert("Payment completed by " + details.payer.name.given_name);
        });
      }
    }).render("#paypal-button-container");
  }

  document.addEventListener("DOMContentLoaded", renderPaypalButton);
  document.addEventListener("turbo:load", renderPaypalButton);
</script>