<section class="product-show">
  <div class="product-show-card">

    <h1><%= @product.name %></h1>

    <% if @product.image_key.present? %>
      <% @product.image_variants.each do |img| %>
        <img
          src="<%= img[:url] %>"
          class="product-main-image"
        >
      <% end %>
    <% end %>

    <p class="product-description"><%= @product.description %></p>

    <% available_variants = @variants.select { |v| v.stock.present? && v.stock > 0 } %>

    <% if @variants.any? %>
      <div class="variant-selector">
        <label for="variant_id">Choose option</label>

        <select id="variant_id">
          <% @variants.each do |variant| %>
            <% out_of_stock = variant.stock.blank? || variant.stock <= 0 %>
            <option
              value="<%= variant.id %>"
              data-price="<%= variant.price_override.nil? ? @product.price : variant.price_override %>"
              <%= "disabled" if out_of_stock %>>
              <%= variant.name %>
              <% if out_of_stock %>
                (Sold out)
              <% elsif variant.stock.present? %>
                (<%= variant.stock %> left)
              <% end %>
            </option>
          <% end %>
        </select>
      </div>
    <% end %>

    <% if @product.price_hidden? %>
      <p class="product-price">Coming Soon</p>
    <% elsif @variants.any? && available_variants.empty? %>
      <p class="product-price">Sold Out</p>
    <% elsif @variants.none? %>
      <p class="product-price">No options available</p>
    <% else %>
      <p class="product-price">
        $<span id="display-price"><%= number_with_precision(@product.price, precision: 2) %></span>
      </p>

      <div class="paypal-container" data-turbo="false">
        <div id="paypal-button-container"></div>
      </div>
    <% end %>

    <%= link_to "Back to products", products_path,
          class: "back-link",
          data: { turbo: false } %>

  </div>
</section>
